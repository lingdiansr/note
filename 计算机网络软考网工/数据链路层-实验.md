# 软考网工-数据链路层实验笔记

## 划分 vlan-基于接口

### 拓扑图

![img](%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/fig_dc_cfg_vlan_004601xs.png)

###  ensp 添加设备

![image-20250412192909387](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412192909387.png)

### 配置 pc 机 ip

![image-20250412182404527](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412182404527.png)

![image-20250412182513620](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412182513620.png)

![image-20250412182522945](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412182522945.png)

![image-20250412182532407](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412182532407.png)

### 配置交换机

#### SwithA

```huawei
# 初始设置
<Huawei>u t m # 关闭终端回显，防止日志输出打断命令
Info: Current terminal monitor is off.
<Huawei>system-view 
Enter system view, return user view with Ctrl+Z.
[Huawei]sysname SwithA

# 创建vlan并分配端口，设置端口为access
[SwithA]vlan batch 2 3
Info: This operation may take a few seconds. Please wait for a moment...done.
[SwithA]interface GigabitEthernet 0/0/2
[SwithA-GigabitEthernet0/0/2]port link-type access 
[SwithA-GigabitEthernet0/0/2]port default vlan 2
[SwithA-GigabitEthernet0/0/2]display this # 展示当前项目下的配置
#
interface GigabitEthernet0/0/2
 port link-type access
 port default vlan 2
#
return
[SwithA-GigabitEthernet0/0/2]q # 退出当前项
[SwithA]int g0/0/3 # 进入端口的简写
[SwithA-GigabitEthernet0/0/3]p l a # 设置端口链路类型为access的简写
[SwithA-GigabitEthernet0/0/3]p d v 3 # 设置端口默认vlan id 为3的简写
[SwithA-GigabitEthernet0/0/3]display this
#
interface GigabitEthernet0/0/3
 port link-type access
 port default vlan 3
#
return
[SwithA-GigabitEthernet0/0/3]q

# 配置交换机之间的主干链路为trunk，允许通过2、3 vlan
[SwithA]interface GigabitEthernet 0/0/1
[SwithA-GigabitEthernet0/0/1]port link-type trunk 
[SwithA-GigabitEthernet0/0/1]port trunk allow-pass vlan 2 3
[SwithA-GigabitEthernet0/0/1]dis th
#
interface GigabitEthernet0/0/1
 port link-type trunk
 port trunk allow-pass vlan 2 to 3
#
return

# 查看vlan配置
[SwithA]display vlan
The total number of vlans is : 3
--------------------------------------------------------------------------------
U: Up;         D: Down;         TG: Tagged;         UT: Untagged;
MP: Vlan-mapping;               ST: Vlan-stacking;
#: ProtocolTransparent-vlan;    *: Management-vlan;
--------------------------------------------------------------------------------

VID  Type    Ports                                                          
--------------------------------------------------------------------------------
1    common  UT:GE0/0/1(U)      GE0/0/4(D)      GE0/0/5(D)      GE0/0/6(D)      
                GE0/0/7(D)      GE0/0/8(D)      GE0/0/9(D)      GE0/0/10(D)     
                GE0/0/11(D)     GE0/0/12(D)     GE0/0/13(D)     GE0/0/14(D)     
                GE0/0/15(D)     GE0/0/16(D)     GE0/0/17(D)     GE0/0/18(D)     
                GE0/0/19(D)     GE0/0/20(D)     GE0/0/21(D)     GE0/0/22(D)     
                GE0/0/23(D)     GE0/0/24(D)                                     

2    common  UT:GE0/0/2(U)                                                      
             TG:GE0/0/1(U)                                                      
3    common  UT:GE0/0/3(U)                                                      
             TG:GE0/0/1(U)                                                      

VID  Status  Property      MAC-LRN Statistics Description      
--------------------------------------------------------------------------------
1    enable  default       enable  disable    VLAN 0001                         
2    enable  default       enable  disable    VLAN 0002                         
3    enable  default       enable  disable    VLAN 0003   
# 查看端口vlan
[SwithA]dis p v
Port                    Link Type    PVID  Trunk VLAN List
-------------------------------------------------------------------------------
GigabitEthernet0/0/1    trunk        1     1-3
GigabitEthernet0/0/2    access       2     -                                   
GigabitEthernet0/0/3    access       3     -                                   
GigabitEthernet0/0/4    hybrid       1     -                                   
GigabitEthernet0/0/5    hybrid       1     -                                   
GigabitEthernet0/0/6    hybrid       1     -                                   
GigabitEthernet0/0/7    hybrid       1     -                                   
GigabitEthernet0/0/8    hybrid       1     -                                   
GigabitEthernet0/0/9    hybrid       1     -                                   
GigabitEthernet0/0/10   hybrid       1     -                                   
GigabitEthernet0/0/11   hybrid       1     -                                   
GigabitEthernet0/0/12   hybrid       1     -                                   
GigabitEthernet0/0/13   hybrid       1     -                                   
GigabitEthernet0/0/14   hybrid       1     -                                   
GigabitEthernet0/0/15   hybrid       1     -                                   
GigabitEthernet0/0/16   hybrid       1     -                                   
GigabitEthernet0/0/17   hybrid       1     -                                   
GigabitEthernet0/0/18   hybrid       1     -                                   
GigabitEthernet0/0/19   hybrid       1     -                                   
GigabitEthernet0/0/20   hybrid       1     -                                   
GigabitEthernet0/0/21   hybrid       1     -                                   
GigabitEthernet0/0/22   hybrid       1     -                                   
GigabitEthernet0/0/23   hybrid       1     -                                   
GigabitEthernet0/0/24   hybrid       1     - 
```

#### SwithB

与 SwithA 类似。

```huawei
<Huawei>u t m
Info: Current terminal monitor is off.
<Huawei>sys
Enter system view, return user view with Ctrl+Z.
[Huawei]v b 2 3
Info: This operation may take a few seconds. Please wait for a moment...done.
[Huawei]int g0/0/2
[Huawei-GigabitEthernet0/0/2]p l a
[Huawei-GigabitEthernet0/0/2]p d v 2
[Huawei-GigabitEthernet0/0/2]q
[Huawei]int g0/0/3
[Huawei-GigabitEthernet0/0/3]p l a
[Huawei-GigabitEthernet0/0/3]p d v 3
[Huawei-GigabitEthernet0/0/3]q
[Huawei]int g0/0/1
[Huawei-GigabitEthernet0/0/1]p l t
[Huawei-GigabitEthernet0/0/1]p t a v 2 3
[Huawei-GigabitEthernet0/0/1]q
[Huawei]dis vl
The total number of vlans is : 3
--------------------------------------------------------------------------------
U: Up;         D: Down;         TG: Tagged;         UT: Untagged;
MP: Vlan-mapping;               ST: Vlan-stacking;
#: ProtocolTransparent-vlan;    *: Management-vlan;
--------------------------------------------------------------------------------

VID  Type    Ports                                                          
--------------------------------------------------------------------------------
1    common  UT:GE0/0/1(U)      GE0/0/4(D)      GE0/0/5(D)      GE0/0/6(D)      
                GE0/0/7(D)      GE0/0/8(D)      GE0/0/9(D)      GE0/0/10(D)     
                GE0/0/11(D)     GE0/0/12(D)     GE0/0/13(D)     GE0/0/14(D)     
                GE0/0/15(D)     GE0/0/16(D)     GE0/0/17(D)     GE0/0/18(D)     
                GE0/0/19(D)     GE0/0/20(D)     GE0/0/21(D)     GE0/0/22(D)     
                GE0/0/23(D)     GE0/0/24(D)                                     

2    common  UT:GE0/0/2(U)                                                      
             TG:GE0/0/1(U)                                                      
3    common  UT:GE0/0/3(U)                                                      
             TG:GE0/0/1(U)                                                      


VID  Status  Property      MAC-LRN Statistics Description      
--------------------------------------------------------------------------------
1    enable  default       enable  disable    VLAN 0001                         
2    enable  default       enable  disable    VLAN 0002                         
3    enable  default       enable  disable    VLAN 0003      
[Huawei]dis p v
Port                    Link Type    PVID  Trunk VLAN List
-------------------------------------------------------------------------------
GigabitEthernet0/0/1    trunk        1     1-3
GigabitEthernet0/0/2    access       2     -                                   
GigabitEthernet0/0/3    access       3     -                                   
GigabitEthernet0/0/4    hybrid       1     -                                   
GigabitEthernet0/0/5    hybrid       1     -                                   
GigabitEthernet0/0/6    hybrid       1     -                                   
GigabitEthernet0/0/7    hybrid       1     -                                   
GigabitEthernet0/0/8    hybrid       1     -                                   
GigabitEthernet0/0/9    hybrid       1     -                                   
GigabitEthernet0/0/10   hybrid       1     -                                   
GigabitEthernet0/0/11   hybrid       1     -                                   
GigabitEthernet0/0/12   hybrid       1     -                                   
GigabitEthernet0/0/13   hybrid       1     -                                   
GigabitEthernet0/0/14   hybrid       1     -                                   
GigabitEthernet0/0/15   hybrid       1     -                                   
GigabitEthernet0/0/16   hybrid       1     -                                   
GigabitEthernet0/0/17   hybrid       1     -                                   
GigabitEthernet0/0/18   hybrid       1     -                                   
GigabitEthernet0/0/19   hybrid       1     -                                   
GigabitEthernet0/0/20   hybrid       1     -                                   
GigabitEthernet0/0/21   hybrid       1     -                                   
GigabitEthernet0/0/22   hybrid       1     -                                   
GigabitEthernet0/0/23   hybrid       1     -                                   
GigabitEthernet0/0/24   hybrid       1     -       
```

### 验证连通性并分析报文

抓包 SwithA 的 g0/0/1 口，从 user1 ping user2

![image-20250412192342667](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412192342667.png)

![image-20250412192539790](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412192539790.png)

可以看到先发送了 ARP 广播建立 mac-ip 表，再发送 icmp ping 报文，在二层被封装为 802.1Q 帧，vlan id 为 2 。

vlan 3 类似。

### 跨vlan通讯

必须借助三层设备

#### Vlanif

S5700就是三层交换机，可以充当网关。

```huawei
[SwithA]interface Vlanif 2 # 进入vlan 2
[SwithA-Vlanif2]ip address 192.168.20.254 24
[SwithA-Vlanif2]q
[SwithA]int v 3 # 简写命令
[SwithA-Vlanif3]ip address 192.168.30.254 24
[SwithA-Vlanif3]q
```

设置PC机网关

![image-20250412193618896](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412193618896.png)

![image-20250412193618896](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412193631207.png)

![image-20250412193721034](./%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82-%E5%AE%9E%E9%AA%8C.assets/image-20250412193721034.png)

可以通讯。